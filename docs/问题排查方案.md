# 问题排查方案

## 环境配置常见问题

1. 在 Windows 系统中，如果运行`windows_install.bat`时出现闪退现象，请检查当前用户是否具有管理员权限。
2. 在 Windows 系统中，如果运行`windows_install.bat`时出现提示`系统找不到指定的路径`，请将文件夹移动到不含有中文等特殊字符的目录，然后再试一次。

## 程序运行常见问题

如果下载的文件非常小，请从第一步开始；如果程序运行时直接提示某一步执行失败，请从第二步开始。

### 第一步：定位问题出现位置

1. 如果是阿里云 OCR + Windows 系统，本程序提供了常见问题的快速排除测试脚本。请运行`tools`文件夹下的`aliyun_ocr_test.bat`和`qwen_test.bat`，运行完成后，观察该目录下是否出现`error_[yyyymmddhhmmss].txt`文件。如果有相应文件，请根据文件的报错内容进行故障排除。常见的问题包括但不限于开通 OCR 服务时选择了错误的服务、未授予 RAM 用户正确权限、账户余额不足等。
2. 如果上一步运行正常，检查`automark_raw_data`和`automarker_colour`文件夹内容。如果`automark_raw_data`有文件但`automarker_colour`为空，则问题可能出在`mark_colour`步骤。值得注意的是，在问题环境中单独执行`mark_colour`脚本时能正常运行且无报错，因此具体原因尚待确定。
3. 如果上一部无法使用或未定位到问题，请进入项目目录`data`文件夹中查看处理记录。每个处理记录文件夹下的`input_pdf`文件夹存储了原始 PDF 文件，可以通过这种方式找到对应的处理记录。
4. 根据[数据关系传递](./数据关系传递.svg)对应到出错的具体步骤。具体来说，如果某一步的输入文件夹有文件，但输出文件夹为空，则问题出在该步骤。

### 第二步：故障脚本单元测试

1. 将出错的流程的缓存目录（例如`20250127005824_d615qw`）的全部子目录移动到`data`文件夹下；
2. 修改`raw_content`文件夹下`file_info.json`中的路径，具体来说，需要删除`data`和`raw_content`两文件夹之间的那一层；
2. Win + R 打开`cmd`，依次运行如下命令：
    ```cmd
    cd [项目根目录，例如 C:\Users\Administrator\Desktop\autoContents]
    call .venv\Scripts\activate.bat
    python mainprogress\[出错步骤脚本，例如 mark_colour.py]
    ```
3. 将输出结果复制到其他 txt 文档中备用。

## 后续步骤

1. 若该方法中的某一步的操作或结果看不懂，请询问 DeepSeek 以寻求进一步指导。
2. 若确定问题所在位置但无法解决，请将“故障脚本单元测试”部分的输出结果发送至邮箱`uijm2004@outlook.com`或提出 Issue 以获取协助。