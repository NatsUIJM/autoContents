# 问题排查方案

## 环境配置部分

1. 在 Windows 系统中，如果运行`windows_install.bat`时出现闪退现象，请检查当前用户是否具有管理员权限。
2. 在 Windows 系统中，如果运行`windows_install.bat`时出现提示`系统找不到指定的路径`，请将文件夹移动到不含有中文等特殊字符的目录，然后再试一次。

## 程序运行部分

1. 打开根目录下的`data`文件夹，并找到出错的任务对应的缓存文件夹（例如`20250306124605_d56W1A`）。每个缓存文件夹中的`input_pdf`中存储了该流程的原始 PDF 文件。如果运行时产生报错，请按照`正常执行的最后一步`来排查；如果运行正常但处理结果损坏，请按照`非空文件夹`和`空文件夹`的情况来排查。

| 非空文件夹          | 空文件夹                | 执行成功的最后一步 | 解决方案  |
| ------------------- | ----------------------- | ------------------ | --------- |
| `mark/input_image`  | `automark_raw_data`     | PDF 转换为图像     | 跳转至`2` |
| `automark_raw_data` | `automarker_colour`     | OCR 识别与投影     | 跳转至`3` |
| `raw_content`       | `llm_processed_content` | 内容预处理         | 跳转至`4` |

2. 如果是阿里云 OCR + Windows 系统，程序提供了本步骤常见问题的快速排除测试脚本。请运行`tools`文件夹下的`aliyun_ocr_test.bat`，运行完成后，观察该目录下是否出现`error_[yyyymmddhhmmss].txt`文件。如果有相应文件，请根据文件的报错内容进行故障排除。如果是其他环境，也请先手动检查问题是否出现在下方所提及的内容中。
   1. **`Error`为`ocrServiceNotOpen`**：参照[申请云服务账户教程](./如何申请云服务账户.md)的`1.2 通用文字识别 API`进行申请，注意第一步应选择**通用文字识别**而不是 OCR 统一识别。
   2. **`Error`为`noPermission`**：参照[申请云服务账户教程](./如何申请云服务账户.md)的`1.2 通用文字识别 API`的第`4`条进行申请：登陆[阿里云 RAM 控制台](https://ram.console.aliyun.com/permissions)，点击“新增授权”，然后为 RAM 账户授予`AliyunOCRFullAccess`权限。
3. 此问题只会在部分 Windows 系统中出现。但在存在该问题的环境中单步运行该脚本则可以正常运行，因此目前未捕获到任何有效的错误信息。建议更换至其他系统后再试一次。
4. 如果是阿里云 OCR + Windows 系统，程序提供了本步骤常见问题的快速排除测试脚本。请运行`tools`文件夹下的`qwen_test.bat`，运行完成后，观察该目录下是否出现`error_[yyyymmddhhmmss].txt`文件。如果有相应文件，请根据文件的报错内容进行故障排除。如果是其他环境，也请先手动检查问题是否出现在下方所提及的内容中。
   1. **`Error`为`AccessDenied.Unpurchased`**：前往[通义大模型官网](https://www.aliyun.com/product/tongyi)，点击右上角的用户，然后点击费用与成本，进行小额充值，然后再试一次。
   2. 若该脚本测试正常，请检查书中是否存在可能导致模型截断响应的敏感信息。

## 其他问题

1. 若该方法中的某一步的操作或结果看不懂，请询问 DeepSeek 以寻求进一步指导。
2. 若上述所有步骤均已完成但依旧无法运行，或上方所列出的方案不适用于你的情况（例如使用的是 Azure 服务或表格中没有列出你的问题），请将`data`文件夹中出错的任务对应的缓存文件夹打包发送至`uijm2004@outlook.com`中，我会尽快协助你。